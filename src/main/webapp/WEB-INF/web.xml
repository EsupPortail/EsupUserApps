<?xml version="1.0" encoding="ISO-8859-1"?>
<!--

    Licensed to Jasig under one or more contributor license
    agreements. See the NOTICE file distributed with this work
    for additional information regarding copyright ownership.
    Jasig licenses this file to you under the Apache License,
    Version 2.0 (the "License"); you may not use this file
    except in compliance with the License. You may obtain a
    copy of the License at:

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on
    an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied. See the License for the
    specific language governing permissions and limitations
    under the License.

-->

<web-app 
    xmlns="http://java.sun.com/xml/ns/javaee"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"
    metadata-complete="true"
    version="2.5">
    
    <display-name>uPortal</display-name>

    <!--
        - Location of the Log4J config file, for initialization and refresh checks.
        - Applied by Log4jConfigListener.
    -->
    <context-param>
        <param-name>log4jConfigLocation</param-name>
        <param-value>/WEB-INF/log4j.properties</param-value>
    </context-param>

    <context-param>
        <!-- the default log4j.properties does not make use of the webapp root feature -->
        <param-name>log4jExposeWebAppRoot</param-name>
        <param-value>false</param-value>
    </context-param>

    <context-param>
        <param-name>log4jRefreshInterval</param-name>
        <!-- interval in milliseconds for checking log4j config for updates -->
        <param-value>60000</param-value>
    </context-param>

    <context-param>
        <param-name>contextConfigLocation</param-name>
        <param-value>classpath:/properties/contexts/*.xml</param-value>
    </context-param>
   
    <!--
        - Configures Log4J for this web app.
        - As this context specifies a context-param "log4jConfigLocation", its file path
        - is used to load the Log4J configuration, including periodic refresh checks.
        -
        - Would fall back to default Log4J initialization (non-refreshing) if no special
        - context-params are given.
        -
        - Optionally exposes a "web app root key", i.e. a system property that specifies the root
        - directory of this web app, for usage in log file paths.
    -->
    <listener>
        <listener-class>org.springframework.web.util.Log4jConfigListener</listener-class>
    </listener>
    
    <!-- 
     | uPortal utility for accessing the WebApplicationContext from code that doesn't have a reference to the ServletContext
     +-->
    <listener>
        <listener-class>org.jasig.portal.spring.PortalApplicationContextLocator</listener-class>
    </listener>

    <!-- 
     | Loads/Unloads the Spring WebApplicationContext
     +-->
    <listener>
        <listener-class>org.springframework.web.context.ContextLoaderListener</listener-class>
    </listener>
    
    <!-- 
     | Passes Session init/destroy events to the WebApplicationContext
     +-->
    <listener>
        <listener-class>org.jasig.portal.spring.web.context.support.ApplicationContextDelagatingSessionListener</listener-class>
    </listener>
    
    <!-- 
     | Exposes the current RequstAttributes object
     +-->
    <listener>
        <listener-class>org.springframework.web.context.request.RequestContextListener</listener-class>
    </listener>
    
    <!-- 
     | Add Session and Request MUTEX objects
     +-->
    <listener>
        <listener-class>org.springframework.web.util.HttpSessionMutexListener</listener-class>
    </listener>
    <listener>
        <listener-class>org.jasig.portal.utils.web.RequestAttributeMutexListener</listener-class>
    </listener>

	
    <filter>
        <filter-name>CAS Validate Filter</filter-name>
        <filter-class>org.jasig.cas.client.validation.Cas20ProxyReceivingTicketValidationFilter</filter-class>
        <init-param>
          <param-name>casServerUrlPrefix</param-name>
            <param-value>https://cas-test.univ-paris1.fr/cas</param-value>
			<!--<param-value>http://cas-test.univ-paris1.fr/cas</param-value>-->
        </init-param>
        <init-param>
          <param-name>serverName</param-name>
          <param-value>uportal3-test.univ-paris1.fr</param-value>
        </init-param>
        <init-param>
            <param-name>proxyCallbackUrl</param-name>
            <param-value>https://uportal3-test.univ-paris1.fr/CasProxyServlet</param-value>
        </init-param>
        <init-param>
            <param-name>proxyReceptorUrl</param-name>
            <param-value>/CasProxyServlet</param-value>
        </init-param>
    </filter>
    
    <filter>
        <filter-name>CAS Assertion ThreadLocal Filter</filter-name>
        <filter-class>org.jasig.cas.client.util.AssertionThreadLocalFilter</filter-class>
    </filter>
    
    
    <filter>
        <filter-name>maxInactiveFilter</filter-name>
        <filter-class>org.springframework.web.filter.DelegatingFilterProxy</filter-class>
    </filter>
    
    <filter>
        <filter-name>requestAttributeSourceFilter</filter-name>
        <filter-class>org.springframework.web.filter.DelegatingFilterProxy</filter-class>
    </filter>

    <filter>
        <filter-name>OpenEntityManagerInViewFilter</filter-name>
        <filter-class>org.springframework.orm.jpa.support.OpenEntityManagerInViewFilter</filter-class>
    </filter>

    <filter>
        <filter-name>pageCachingFilter</filter-name>
        <filter-class>org.springframework.web.filter.DelegatingFilterProxy</filter-class>
        <init-param>
            <param-name>targetFilterLifecycle</param-name>
            <param-value>true</param-value>
        </init-param>
    </filter>
    
    <filter>
        <filter-name>CacheExpiresFilter</filter-name>
        <filter-class>org.springframework.web.filter.DelegatingFilterProxy</filter-class>
    </filter>
    
    
    
    <filter-mapping>
        <filter-name>CAS Validate Filter</filter-name>
        <url-pattern>/Login</url-pattern>
    </filter-mapping>

    <filter-mapping>
        <filter-name>CAS Validate Filter</filter-name>
        <url-pattern>/CasProxyServlet</url-pattern>
    </filter-mapping>

    <filter-mapping>
        <filter-name>CAS Assertion ThreadLocal Filter</filter-name>
        <url-pattern>/Login</url-pattern>
    </filter-mapping>
    
    
    <filter-mapping>
        <filter-name>maxInactiveFilter</filter-name>
        <url-pattern>/Login</url-pattern>
    </filter-mapping>

    <filter-mapping>
        <filter-name>OpenEntityManagerInViewFilter</filter-name>
        <url-pattern>/*</url-pattern>
    </filter-mapping>
    
    <filter-mapping>
        <filter-name>requestAttributeSourceFilter</filter-name>
        <url-pattern>/Login</url-pattern>
    </filter-mapping>

    <filter-mapping>
        <filter-name>CacheExpiresFilter</filter-name>
        <url-pattern>/media/*</url-pattern>
        <url-pattern>*.js</url-pattern>
        <url-pattern>*.css</url-pattern>
    </filter-mapping>
    
    <servlet>
        <servlet-name>uPortal</servlet-name>
        <servlet-class>org.jasig.portal.PortalSessionManager</servlet-class>
        <load-on-startup>1</load-on-startup>
    </servlet>

    <servlet>
        <servlet-name>Login</servlet-name>
        <servlet-class>org.jasig.portal.LoginServlet</servlet-class>
        <load-on-startup>2</load-on-startup>
    </servlet>

    <servlet>
        <servlet-name>Logout</servlet-name>
        <servlet-class>org.jasig.portal.LogoutServlet</servlet-class>
        <load-on-startup>3</load-on-startup>
    </servlet>

    <!-- Uncomment this servlet and the corresponding servlet-mapping if ProxyWriter is enabled in portal.properties
    <servlet>
        <servlet-name>HttpProxyServlet</servlet-name>
        <servlet-class>org.jasig.portal.HttpProxyServlet</servlet-class>
    </servlet>
    -->
    <servlet>
        <servlet-name>Problems</servlet-name>
        <servlet-class>org.jasig.portal.Problems</servlet-class>
    </servlet>

    <servlet>
        <servlet-name>Instrumentation</servlet-name>
        <servlet-class>org.jasig.portal.tools.checks.ChecksServlet</servlet-class>
    </servlet>

    <servlet>
        <servlet-name>UpdatePreferencesServlet</servlet-name>
        <servlet-class>org.jasig.portal.layout.dlm.remoting.UpdatePreferencesServlet</servlet-class>
    </servlet>
    
    <!-- Supports view rendering -->
    <servlet>
        <servlet-name>ViewRendererServlet</servlet-name>
        <servlet-class>org.springframework.web.servlet.ViewRendererServlet</servlet-class>
    </servlet>
    
    <!-- Supports Spring controllers -->
    <servlet>
        <servlet-name>spring</servlet-name>
        <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>
        <init-param>
            <param-name>contextConfigLocation</param-name>
            <param-value>classpath:properties/contexts/mvcServletContext.xml</param-value>
        </init-param>
        <load-on-startup>1</load-on-startup>
    </servlet>
        
    <!-- Serves static resource content from .jar files such as spring-js.jar -->
    <servlet>
        <servlet-name>Resources Servlet</servlet-name>
        <servlet-class>org.springframework.js.resource.ResourceServlet</servlet-class>
        <load-on-startup>0</load-on-startup>
    </servlet>

    <servlet>
        <servlet-name>ImportExportServlet</servlet-name>
        <servlet-class>org.danann.cernunnos.runtime.web.CernunnosServlet</servlet-class>
        <init-param>
            <param-name>scriptLocation</param-name>
            <param-value>ImportExportPortlet/doDownload</param-value>
        </init-param>
    </servlet>

	<servlet>
		<servlet-name>Guest</servlet-name>
		<servlet-class>org.jasig.portal.GuestServlet</servlet-class>
		<load-on-startup>2</load-on-startup>
	</servlet>
  
	<servlet>
		<servlet-name>ExternalURLStats</servlet-name>   
		<servlet-class>org.esupportail.portal.services.stats.StatsRecorderExternalURLServlet</servlet-class>
	</servlet>
  
	
	<servlet>
	  <servlet-name>EsupMonitor</servlet-name>
	  <servlet-class>org.esupportail.portal.utils.EsupMonitor</servlet-class>
	  <init-param>
	       <param-name>org.esupportail.portal.utils.EsupMonitor.maxUserShow</param-name>
	       <param-value>100</param-value>
	  </init-param>	  
	  <init-param>
	       <param-name>java.naming.factory.initial</param-name>
	       <param-value>org.jasig.portal.jndi.DisposableMemoryContextFactory</param-value>
	  </init-param>
	  <!-- 
	  <init-param>
		    <param-name>org.esupportail.portal.utils.EsupMonitor.lsofCmd</param-name>
       		<param-value>/usr/sbin/lsof -p %p</param-value>
  	   </init-param>
	   -->
	</servlet> 
	

	
	 <servlet>
	  <servlet-name>AxisServlet</servlet-name> 
	  <display-name>Apache-Axis Servlet</display-name> 
	  <servlet-class>org.apache.axis.transport.http.AxisServlet</servlet-class> 
	 </servlet>
	
	
	<!-- HTTPSGateway -->
	<servlet>
	    <servlet-name>HTTPSGateway</servlet-name>
	    <servlet-class>org.esupportail.portal.security.HTTPSGatewayServlet</servlet-class>
	    <init-param>
		<param-name>org.esupportail.portal.security.HTTPSGatewayServlet.sessionname</param-name>
		<param-value>jsessionid</param-value>
	    </init-param>
	    <init-param>
		<param-name>org.esupportail.portal.security.HTTPSGatewayServlet.virtualUrl</param-name>
		<param-value>https://uportal3-test.univ-paris1.fr</param-value>
	    </init-param>
	    <init-param>
		<param-name>org.esupportail.portal.security.HTTPSGatewayServlet.realUrl</param-name>
		<param-value>https://uportal3-test.univ-paris1.fr</param-value>
	    </init-param>
	    <load-on-startup>4</load-on-startup>
	</servlet> 
	
    <!-- [INSERT JSPC FRAGMENT HERE] -->

    <servlet-mapping>
        <servlet-name>ViewRendererServlet</servlet-name>
        <url-pattern>/WEB-INF/servlet/view</url-pattern>
    </servlet-mapping>
    
    <!-- Map all /resources requests to the Resource Servlet for handling -->
    <servlet-mapping>
        <servlet-name>Resources Servlet</servlet-name>
        <url-pattern>/resources/*</url-pattern>
    </servlet-mapping>

    <servlet-mapping>
        <servlet-name>uPortal</servlet-name>
        <url-pattern>*.uP</url-pattern>
    </servlet-mapping>

    <servlet-mapping>
        <servlet-name>Login</servlet-name>
        <url-pattern>/Login</url-pattern>
    </servlet-mapping>

    <servlet-mapping>
        <servlet-name>Logout</servlet-name>
        <url-pattern>/Logout</url-pattern>
    </servlet-mapping>

    <!-- Uncomment this servlet-mapping and the corresponding servlet if ProxyWriter is enabled in portal.properties
    <servlet-mapping>
        <servlet-name>HttpProxyServlet</servlet-name>
        <url-pattern>/servlet/ProxyServlet/*</url-pattern>
    </servlet-mapping>
    -->
    <servlet-mapping>
        <servlet-name>uPortal</servlet-name>
        <url-pattern>/worker/download/*</url-pattern>
    </servlet-mapping>

    <servlet-mapping>
        <servlet-name>Problems</servlet-name>
        <url-pattern>/problems</url-pattern>
    </servlet-mapping>

    <servlet-mapping>
        <servlet-name>Instrumentation</servlet-name>
        <url-pattern>/instrumentation</url-pattern>
    </servlet-mapping>

    <servlet-mapping>
        <servlet-name>UpdatePreferencesServlet</servlet-name>
        <url-pattern>/ajax/preferences</url-pattern>
    </servlet-mapping>

    <servlet-mapping>
        <servlet-name>ImportExportServlet</servlet-name>
        <url-pattern>/ImportExportServlet/*</url-pattern>
    </servlet-mapping>

	<servlet-mapping>
		<servlet-name>Guest</servlet-name>
		<url-pattern>/Guest</url-pattern>
	</servlet-mapping>
	
	
	  <servlet-mapping>
	    <servlet-name>AxisServlet</servlet-name> 
	    <url-pattern>/services/*</url-pattern> 
	</servlet-mapping>
	

    <filter>
	<filter-name>CAS Single Sign Out Filter</filter-name>
	<filter-class>org.jasig.cas.client.session.SingleSignOutFilter</filter-class>
    </filter>

    <filter>
        <filter-name>CAS Validate Filter Simple</filter-name>
        <filter-class>org.jasig.cas.client.validation.Cas20ProxyReceivingTicketValidationFilter</filter-class>
        <init-param>
          <param-name>casServerUrlPrefix</param-name>
            <param-value>https://cas-test.univ-paris1.fr/cas</param-value>
			<!--<param-value>http://cas-test.univ-paris1.fr/cas</param-value>-->
        </init-param>
        <init-param>
          <param-name>serverName</param-name>
          <param-value>uportal3-test.univ-paris1.fr</param-value>
        </init-param>
        <init-param>
          <param-name>redirectAfterValidation</param-name>
          <param-value>false</param-value>
        </init-param>	
    </filter>
	
    <filter-mapping>
        <filter-name>CAS Single Sign Out Filter</filter-name>
        <url-pattern>/ProlongationENT/js</url-pattern>
    </filter-mapping>
    <filter-mapping>
        <filter-name>CAS Validate Filter Simple</filter-name>
        <url-pattern>/ProlongationENT/js</url-pattern>
    </filter-mapping>

	<servlet>
	  <servlet-name>ProlongationENT</servlet-name> 
	  <servlet-class>org.esupportail.portal.services.ProlongationENT</servlet-class>
	</servlet>

	<servlet-mapping>
	    <servlet-name>ProlongationENT</servlet-name> 
	    <url-pattern>/ProlongationENT/js</url-pattern> 
	</servlet-mapping>

	<servlet-mapping>
	    <servlet-name>ProlongationENT</servlet-name> 
	    <url-pattern>/ProlongationENT/detectReload</url-pattern> 
	</servlet-mapping>

	<servlet-mapping>
	    <servlet-name>ProlongationENT</servlet-name> 
	    <url-pattern>/ProlongationENT/purgeCache</url-pattern> 
	</servlet-mapping>

	<servlet-mapping>
	    <servlet-name>ProlongationENT</servlet-name> 
	    <url-pattern>/ProlongationENT/logout</url-pattern> 
	</servlet-mapping>

	
	<servlet-mapping>
	   <servlet-name>EsupMonitor</servlet-name>
	   <url-pattern>/EsupMonitor</url-pattern>
	</servlet-mapping> 
	

	<servlet-mapping>
		<servlet-name>ExternalURLStats</servlet-name>
		<url-pattern>/ExternalURLStats</url-pattern>
	</servlet-mapping>

	<servlet-mapping>
		<servlet-name>HTTPSGateway</servlet-name>
		<url-pattern>/HTTPSGateway</url-pattern>
	</servlet-mapping>
  
    <servlet-mapping>
        <servlet-name>spring</servlet-name>
        <url-pattern>/mvc/*</url-pattern>
    </servlet-mapping>

    <mime-mapping>
        <extension>wbmp</extension>
        <mime-type>image/vnd.wap.wbmp</mime-type>
    </mime-mapping>

    <welcome-file-list>
        <welcome-file>index.html</welcome-file>
        <welcome-file>index.htm</welcome-file>
        <welcome-file>index.jsp</welcome-file>
    </welcome-file-list>

	<session-config>
      <session-timeout>240</session-timeout>
    </session-config>

</web-app>
